import{s as Ne,i as gt,g as Pe,a as _e,d as et,b as dt,c as mt,e as pt}from"./storage.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();var Re={},yt=function(e,t,r,n,a){var o=new Worker(Re[t]||(Re[t]=URL.createObjectURL(new Blob([e+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return o.onmessage=function(i){var l=i.data,s=l.$e$;if(s){var u=new Error(s[0]);u.code=s[1],u.stack=s[2],a(u,null)}else a(null,l)},o.postMessage(r,n),o},x=Uint8Array,N=Uint16Array,Se=Int32Array,de=new x([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),me=new x([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ie=new x([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),tt=function(e,t){for(var r=new N(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var a=new Se(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)a[o]=o-r[n]<<5|n;return{b:r,r:a}},rt=tt(de,2),Ue=rt.b,Oe=rt.r;Ue[28]=258,Oe[258]=28;var nt=tt(me,0),at=nt.b,qe=nt.r,xe=new N(32768);for(var S=0;S<32768;++S){var ee=(S&43690)>>1|(S&21845)<<1;ee=(ee&52428)>>2|(ee&13107)<<2,ee=(ee&61680)>>4|(ee&3855)<<4,xe[S]=((ee&65280)>>8|(ee&255)<<8)>>1}var K=function(e,t,r){for(var n=e.length,a=0,o=new N(t);a<n;++a)e[a]&&++o[e[a]-1];var i=new N(t);for(a=1;a<t;++a)i[a]=i[a-1]+o[a-1]<<1;var l;if(r){l=new N(1<<t);var s=15-t;for(a=0;a<n;++a)if(e[a])for(var u=a<<4|e[a],c=t-e[a],f=i[e[a]-1]++<<c,v=f|(1<<c)-1;f<=v;++f)l[xe[f]>>s]=u}else for(l=new N(n),a=0;a<n;++a)e[a]&&(l[a]=xe[i[e[a]-1]++]>>15-e[a]);return l},te=new x(288);for(var S=0;S<144;++S)te[S]=8;for(var S=144;S<256;++S)te[S]=9;for(var S=256;S<280;++S)te[S]=7;for(var S=280;S<288;++S)te[S]=8;var ge=new x(32);for(var S=0;S<32;++S)ge[S]=5;var wt=K(te,9,0),ot=K(te,9,1),kt=K(ge,5,0),it=K(ge,5,1),ke=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},j=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},Be=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},Me=function(e){return(e+7)/8|0},se=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new x(e.subarray(t,r))},st=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],I=function(e,t,r){var n=new Error(t||st[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,I),!r)throw n;return n},lt=function(e,t,r,n){var a=e.length,o=n?n.length:0;if(!a||t.f&&!t.l)return r||new x(0);var i=!r,l=i||t.i!=2,s=t.i;i&&(r=new x(a*3));var u=function(ce){var fe=r.length;if(ce>fe){var oe=new x(Math.max(fe*2,ce));oe.set(r),r=oe}},c=t.f||0,f=t.p||0,v=t.b||0,y=t.l,k=t.d,w=t.m,h=t.n,m=a*8;do{if(!y){c=j(e,f,1);var b=j(e,f+1,3);if(f+=3,b)if(b==1)y=ot,k=it,w=9,h=5;else if(b==2){var z=j(e,f,31)+257,C=j(e,f+10,15)+4,p=z+j(e,f+5,31)+1;f+=14;for(var d=new x(p),T=new x(19),M=0;M<C;++M)T[Ie[M]]=j(e,f+M*3,7);f+=C*3;for(var O=ke(T),_=(1<<O)-1,R=K(T,O,1),M=0;M<p;){var U=R[j(e,f,_)];f+=U&15;var g=U>>4;if(g<16)d[M++]=g;else{var D=0,L=0;for(g==16?(L=3+j(e,f,3),f+=2,D=d[M-1]):g==17?(L=3+j(e,f,7),f+=3):g==18&&(L=11+j(e,f,127),f+=7);L--;)d[M++]=D}}var G=d.subarray(0,z),F=d.subarray(z);w=ke(G),h=ke(F),y=K(G,w,1),k=K(F,h,1)}else I(1);else{var g=Me(f)+4,B=e[g-4]|e[g-3]<<8,E=g+B;if(E>a){s&&I(0);break}l&&u(v+B),r.set(e.subarray(g,E),v),t.b=v+=B,t.p=f=E*8,t.f=c;continue}if(f>m){s&&I(0);break}}l&&u(v+131072);for(var le=(1<<w)-1,Z=(1<<h)-1,Q=f;;Q=f){var D=y[Be(e,f)&le],q=D>>4;if(f+=D&15,f>m){s&&I(0);break}if(D||I(2),q<256)r[v++]=q;else if(q==256){Q=f,y=null;break}else{var H=q-254;if(q>264){var M=q-257,A=de[M];H=j(e,f,(1<<A)-1)+Ue[M],f+=A}var V=k[Be(e,f)&Z],ne=V>>4;V||I(3),f+=V&15;var F=at[ne];if(ne>3){var A=me[ne];F+=Be(e,f)&(1<<A)-1,f+=A}if(f>m){s&&I(0);break}l&&u(v+131072);var ae=v+H;if(v<F){var pe=o-F,ye=Math.min(F,ae);for(pe+v<0&&I(3);v<ye;++v)r[v]=n[pe+v]}for(;v<ae;++v)r[v]=r[v-F]}}t.l=y,t.p=Q,t.b=v,t.f=c,y&&(c=1,t.m=w,t.d=k,t.n=h)}while(!c);return v!=r.length&&i?se(r,0,v):r.subarray(0,v)},X=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8},ue=function(e,t,r){r<<=t&7;var n=t/8|0;e[n]|=r,e[n+1]|=r>>8,e[n+2]|=r>>16},$e=function(e,t){for(var r=[],n=0;n<e.length;++n)e[n]&&r.push({s:n,f:e[n]});var a=r.length,o=r.slice();if(!a)return{t:ft,l:0};if(a==1){var i=new x(r[0].s+1);return i[r[0].s]=1,{t:i,l:1}}r.sort(function(E,z){return E.f-z.f}),r.push({s:-1,f:25001});var l=r[0],s=r[1],u=0,c=1,f=2;for(r[0]={s:-1,f:l.f+s.f,l,r:s};c!=a-1;)l=r[r[u].f<r[f].f?u++:f++],s=r[u!=c&&r[u].f<r[f].f?u++:f++],r[c++]={s:-1,f:l.f+s.f,l,r:s};for(var v=o[0].s,n=1;n<a;++n)o[n].s>v&&(v=o[n].s);var y=new N(v+1),k=De(r[c-1],y,0);if(k>t){var n=0,w=0,h=k-t,m=1<<h;for(o.sort(function(z,C){return y[C.s]-y[z.s]||z.f-C.f});n<a;++n){var b=o[n].s;if(y[b]>t)w+=m-(1<<k-y[b]),y[b]=t;else break}for(w>>=h;w>0;){var g=o[n].s;y[g]<t?w-=1<<t-y[g]++-1:++n}for(;n>=0&&w;--n){var B=o[n].s;y[B]==t&&(--y[B],++w)}k=t}return{t:new x(y),l:k}},De=function(e,t,r){return e.s==-1?Math.max(De(e.l,t,r+1),De(e.r,t,r+1)):t[e.s]=r},He=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new N(++t),n=0,a=e[0],o=1,i=function(s){r[n++]=s},l=1;l<=t;++l)if(e[l]==a&&l!=t)++o;else{if(!a&&o>2){for(;o>138;o-=138)i(32754);o>2&&(i(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(i(a),--o;o>6;o-=6)i(8304);o>2&&(i(o-3<<5|8208),o=0)}for(;o--;)i(a);o=1,a=e[l]}return{c:r.subarray(0,n),n:t}},ve=function(e,t){for(var r=0,n=0;n<t.length;++n)r+=e[n]*t[n];return r},ct=function(e,t,r){var n=r.length,a=Me(t+2);e[a]=n&255,e[a+1]=n>>8,e[a+2]=e[a]^255,e[a+3]=e[a+1]^255;for(var o=0;o<n;++o)e[a+o+4]=r[o];return(a+4+n)*8},Ze=function(e,t,r,n,a,o,i,l,s,u,c){X(t,c++,r),++a[256];for(var f=$e(a,15),v=f.t,y=f.l,k=$e(o,15),w=k.t,h=k.l,m=He(v),b=m.c,g=m.n,B=He(w),E=B.c,z=B.n,C=new N(19),p=0;p<b.length;++p)++C[b[p]&31];for(var p=0;p<E.length;++p)++C[E[p]&31];for(var d=$e(C,7),T=d.t,M=d.l,O=19;O>4&&!T[Ie[O-1]];--O);var _=u+5<<3,R=ve(a,te)+ve(o,ge)+i,U=ve(a,v)+ve(o,w)+i+14+3*O+ve(C,T)+2*C[16]+3*C[17]+7*C[18];if(s>=0&&_<=R&&_<=U)return ct(t,c,e.subarray(s,s+u));var D,L,G,F;if(X(t,c,1+(U<R)),c+=2,U<R){D=K(v,y,0),L=v,G=K(w,h,0),F=w;var le=K(T,M,0);X(t,c,g-257),X(t,c+5,z-1),X(t,c+10,O-4),c+=14;for(var p=0;p<O;++p)X(t,c+3*p,T[Ie[p]]);c+=3*O;for(var Z=[b,E],Q=0;Q<2;++Q)for(var q=Z[Q],p=0;p<q.length;++p){var H=q[p]&31;X(t,c,le[H]),c+=T[H],H>15&&(X(t,c,q[p]>>5&127),c+=q[p]>>12)}}else D=wt,L=te,G=kt,F=ge;for(var p=0;p<l;++p){var A=n[p];if(A>255){var H=A>>18&31;ue(t,c,D[H+257]),c+=L[H+257],H>7&&(X(t,c,A>>23&31),c+=de[H]);var V=A&31;ue(t,c,G[V]),c+=F[V],V>3&&(ue(t,c,A>>5&8191),c+=me[V])}else ue(t,c,D[A]),c+=L[A]}return ue(t,c,D[256]),c+L[256]},Bt=new Se([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),ft=new x(0),bt=function(e,t,r,n,a,o){var i=o.z||e.length,l=new x(n+i+5*(1+Math.ceil(i/7e3))+a),s=l.subarray(n,l.length-a),u=o.l,c=(o.r||0)&7;if(t){c&&(s[0]=o.r>>3);for(var f=Bt[t-1],v=f>>13,y=f&8191,k=(1<<r)-1,w=o.p||new N(32768),h=o.h||new N(k+1),m=Math.ceil(r/3),b=2*m,g=function(ze){return(e[ze]^e[ze+1]<<m^e[ze+2]<<b)&k},B=new Se(25e3),E=new N(288),z=new N(32),C=0,p=0,d=o.i||0,T=0,M=o.w||0,O=0;d+2<i;++d){var _=g(d),R=d&32767,U=h[_];if(w[R]=U,h[_]=R,M<=d){var D=i-d;if((C>7e3||T>24576)&&(D>423||!u)){c=Ze(e,s,0,B,E,z,p,T,O,d-O,c),T=C=p=0,O=d;for(var L=0;L<286;++L)E[L]=0;for(var L=0;L<30;++L)z[L]=0}var G=2,F=0,le=y,Z=R-U&32767;if(D>2&&_==g(d-Z))for(var Q=Math.min(v,D)-1,q=Math.min(32767,d),H=Math.min(258,D);Z<=q&&--le&&R!=U;){if(e[d+G]==e[d+G-Z]){for(var A=0;A<H&&e[d+A]==e[d+A-Z];++A);if(A>G){if(G=A,F=Z,A>Q)break;for(var V=Math.min(Z,A-2),ne=0,L=0;L<V;++L){var ae=d-Z+L&32767,pe=w[ae],ye=ae-pe&32767;ye>ne&&(ne=ye,U=ae)}}}R=U,U=w[R],Z+=R-U&32767}if(F){B[T++]=268435456|Oe[G]<<18|qe[F];var ce=Oe[G]&31,fe=qe[F]&31;p+=de[ce]+me[fe],++E[257+ce],++z[fe],M=d+G,++C}else B[T++]=e[d],++E[e[d]]}}for(d=Math.max(d,M);d<i;++d)B[T++]=e[d],++E[e[d]];c=Ze(e,s,u,B,E,z,p,T,O,d-O,c),u||(o.r=c&7|s[c/8|0]<<3,c-=7,o.h=h,o.p=w,o.i=d,o.w=M)}else{for(var d=o.w||0;d<i+u;d+=65535){var oe=d+65535;oe>=i&&(s[c/8|0]=u,oe=i),c=ct(s,c+1,e.subarray(d,oe))}o.i=i}return se(l,0,n+Me(c)+a)},Et=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var r=t,n=9;--n;)r=(r&1&&-306674912)^r>>>1;e[t]=r}return e}(),It=function(){var e=-1;return{p:function(t){for(var r=e,n=0;n<t.length;++n)r=Et[r&255^t[n]]^r>>>8;e=r},d:function(){return~e}}},xt=function(e,t,r,n,a){if(!a&&(a={l:1},t.dictionary)){var o=t.dictionary.subarray(-32768),i=new x(o.length+e.length);i.set(o),i.set(e,o.length),e=i,a.w=o.length}return bt(e,t.level==null?6:t.level,t.mem==null?a.l?Math.ceil(Math.max(8,Math.min(13,Math.log(e.length)))*1.5):20:12+t.mem,r,n,a)},ut=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},je=function(e,t,r){for(var n=e(),a=e.toString(),o=a.slice(a.indexOf("[")+1,a.lastIndexOf("]")).replace(/\s+/g,"").split(","),i=0;i<n.length;++i){var l=n[i],s=o[i];if(typeof l=="function"){t+=";"+s+"=";var u=l.toString();if(l.prototype)if(u.indexOf("[native code]")!=-1){var c=u.indexOf(" ",8)+1;t+=u.slice(c,u.indexOf("(",c))}else{t+=u;for(var f in l.prototype)t+=";"+s+".prototype."+f+"="+l.prototype[f].toString()}else t+=u}else r[s]=l}return t},we=[],St=function(e){var t=[];for(var r in e)e[r].buffer&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t},Mt=function(e,t,r,n){if(!we[r]){for(var a="",o={},i=e.length-1,l=0;l<i;++l)a=je(e[l],a,o);we[r]={c:je(e[i],a,o),e:o}}var s=ut({},we[r].e);return yt(we[r].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,s,St(s),n)},Ct=function(){return[x,N,Se,de,me,Ie,Ue,at,ot,it,xe,st,K,ke,j,Be,Me,se,I,lt,Ge,vt,ht]},vt=function(e){return postMessage(e,[e.buffer])},ht=function(e){return e&&{out:e.size&&new x(e.size),dictionary:e.dictionary}},Lt=function(e,t,r,n,a,o){var i=Mt(r,n,a,function(l,s){i.terminate(),o(l,s)});return i.postMessage([e,t],t.consume?[e.buffer]:[]),function(){i.terminate()}},Y=function(e,t){return e[t]|e[t+1]<<8},W=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},Te=function(e,t){return W(e,t)+W(e,t+4)*4294967296},$=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},At=function(){function e(t,r){if(typeof t=="function"&&(r=t,t={}),this.ondata=r,this.o=t||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new x(98304),this.o.dictionary){var n=this.o.dictionary.subarray(-32768);this.b.set(n,32768-n.length),this.s.i=32768-n.length}}return e.prototype.p=function(t,r){this.ondata(xt(t,this.o,0,0,this.s),r)},e.prototype.push=function(t,r){this.ondata||I(5),this.s.l&&I(4);var n=t.length+this.s.z;if(n>this.b.length){if(n>2*this.b.length-32768){var a=new x(n&-32768);a.set(this.b.subarray(0,this.s.z)),this.b=a}var o=this.b.length-this.s.z;this.b.set(t.subarray(0,o),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(t.subarray(o),32768),this.s.z=t.length-o+32768,this.s.i=32766,this.s.w=32768}else this.b.set(t,this.s.z),this.s.z+=t.length;this.s.l=r&1,(this.s.z>this.s.w+8191||r)&&(this.p(this.b,r||!1),this.s.w=this.s.i,this.s.i-=2)},e.prototype.flush=function(){this.ondata||I(5),this.s.l&&I(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},e}();function zt(e,t,r){return r||(r=t,t={}),typeof r!="function"&&I(7),Lt(e,t,[Ct],function(n){return vt(Ge(n.data[0],ht(n.data[1])))},1,r)}function Ge(e,t){return lt(e,{i:2},t&&t.out,t&&t.dictionary)}var Je=typeof TextEncoder<"u"&&new TextEncoder,Fe=typeof TextDecoder<"u"&&new TextDecoder,$t=0;try{Fe.decode(ft,{stream:!0}),$t=1}catch{}var Tt=function(e){for(var t="",r=0;;){var n=e[r++],a=(n>127)+(n>223)+(n>239);if(r+a>e.length)return{s:t,r:se(e,r-1)};a?a==3?(n=((n&15)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,t+=String.fromCharCode(55296|n>>10,56320|n&1023)):a&1?t+=String.fromCharCode((n&31)<<6|e[r++]&63):t+=String.fromCharCode((n&15)<<12|(e[r++]&63)<<6|e[r++]&63):t+=String.fromCharCode(n)}};function We(e,t){var r;if(Je)return Je.encode(e);for(var n=e.length,a=new x(e.length+(e.length>>1)),o=0,i=function(u){a[o++]=u},r=0;r<n;++r){if(o+5>a.length){var l=new x(o+8+(n-r<<1));l.set(a),a=l}var s=e.charCodeAt(r);s<128||t?i(s):s<2048?(i(192|s>>6),i(128|s&63)):s>55295&&s<57344?(s=65536+(s&1047552)|e.charCodeAt(++r)&1023,i(240|s>>18),i(128|s>>12&63),i(128|s>>6&63),i(128|s&63)):(i(224|s>>12),i(128|s>>6&63),i(128|s&63))}return se(a,0,o)}function Ot(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}else{if(Fe)return Fe.decode(e);var a=Tt(e),o=a.s,r=a.r;return r.length&&I(8),o}}var Dt=function(e){return e==1?3:e<6?2:e==9?1:0},Ft=function(e,t){return t+30+Y(e,t+26)+Y(e,t+28)},Pt=function(e,t,r){var n=Y(e,t+28),a=Ot(e.subarray(t+46,t+46+n),!(Y(e,t+8)&2048)),o=t+46+n,i=W(e,t+20),l=r&&i==4294967295?Ut(e,o):[i,W(e,t+24),W(e,t+42)],s=l[0],u=l[1],c=l[2];return[Y(e,t+10),s,u,a,o+Y(e,t+30)+Y(e,t+32),c]},Ut=function(e,t){for(;Y(e,t)!=1;t+=4+Y(e,t+2));return[Te(e,t+12),Te(e,t+4),Te(e,t+20)]},be=function(e){var t=0;if(e)for(var r in e){var n=e[r].length;n>65535&&I(9),t+=n+4}return t},Ke=function(e,t,r,n,a,o,i,l){var s=n.length,u=r.extra,c=l&&l.length,f=be(u);$(e,t,i!=null?33639248:67324752),t+=4,i!=null&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(o<0&&8),e[t++]=a&&8,e[t++]=r.compression&255,e[t++]=r.compression>>8;var v=new Date(r.mtime==null?Date.now():r.mtime),y=v.getFullYear()-1980;if((y<0||y>119)&&I(10),$(e,t,y<<25|v.getMonth()+1<<21|v.getDate()<<16|v.getHours()<<11|v.getMinutes()<<5|v.getSeconds()>>1),t+=4,o!=-1&&($(e,t,r.crc),$(e,t+4,o<0?-o-2:o),$(e,t+8,r.size)),$(e,t+12,s),$(e,t+14,f),t+=16,i!=null&&($(e,t,c),$(e,t+6,r.attrs),$(e,t+10,i),t+=14),e.set(n,t),t+=s,f)for(var k in u){var w=u[k],h=w.length;$(e,t,+k),$(e,t+2,h),e.set(w,t+4),t+=4+h}return c&&(e.set(l,t),t+=c),t},Gt=function(e,t,r,n,a){$(e,t,101010256),$(e,t+8,r),$(e,t+10,r),$(e,t+12,n),$(e,t+16,a)},Ve=function(){function e(t){this.filename=t,this.c=It(),this.size=0,this.compression=0}return e.prototype.process=function(t,r){this.ondata(null,t,r)},e.prototype.push=function(t,r){this.ondata||I(5),this.c.p(t),this.size+=t.length,r&&(this.crc=this.c.d()),this.process(t,r||!1)},e}(),Ye=function(){function e(t,r){var n=this;r||(r={}),Ve.call(this,t),this.d=new At(r,function(a,o){n.ondata(null,a,o)}),this.compression=8,this.flag=Dt(r.level)}return e.prototype.process=function(t,r){try{this.d.push(t,r)}catch(n){this.ondata(n,null,r)}},e.prototype.push=function(t,r){Ve.prototype.push.call(this,t,r)},e}(),Nt=function(){function e(t){this.ondata=t,this.u=[],this.d=1}return e.prototype.add=function(t){var r=this;if(this.ondata||I(5),this.d&2)this.ondata(I(4+(this.d&1)*8,0,1),null,!1);else{var n=We(t.filename),a=n.length,o=t.comment,i=o&&We(o),l=a!=t.filename.length||i&&o.length!=i.length,s=a+be(t.extra)+30;a>65535&&this.ondata(I(11,0,1),null,!1);var u=new x(s);Ke(u,0,t,n,l,-1);var c=[u],f=function(){for(var h=0,m=c;h<m.length;h++){var b=m[h];r.ondata(null,b,!1)}c=[]},v=this.d;this.d=0;var y=this.u.length,k=ut(t,{f:n,u:l,o:i,t:function(){t.terminate&&t.terminate()},r:function(){if(f(),v){var h=r.u[y+1];h?h.r():r.d=1}v=1}}),w=0;t.ondata=function(h,m,b){if(h)r.ondata(h,m,b),r.terminate();else if(w+=m.length,c.push(m),b){var g=new x(16);$(g,0,134695760),$(g,4,t.crc),$(g,8,w),$(g,12,t.size),c.push(g),k.c=w,k.b=s+w+16,k.crc=t.crc,k.size=t.size,v&&k.r(),v=1}else v&&f()},this.u.push(k)}},e.prototype.end=function(){var t=this;if(this.d&2){this.ondata(I(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){t.d&1&&(t.u.splice(-1,1),t.e())},t:function(){}}),this.d=3},e.prototype.e=function(){for(var t=0,r=0,n=0,a=0,o=this.u;a<o.length;a++){var i=o[a];n+=46+i.f.length+be(i.extra)+(i.o?i.o.length:0)}for(var l=new x(n+22),s=0,u=this.u;s<u.length;s++){var i=u[s];Ke(l,t,i,i.f,i.u,-i.c-2,r,i.o),t+=46+i.f.length+be(i.extra)+(i.o?i.o.length:0),r+=i.b}Gt(l,t,this.u.length,n,r),this.ondata(null,l,!0),this.d=2},e.prototype.terminate=function(){for(var t=0,r=this.u;t<r.length;t++){var n=r[t];n.t()}this.d=2},e}(),Qe=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(e){e()};function Rt(e,t,r){r||(r=t,t={}),typeof r!="function"&&I(7);var n=[],a=function(){for(var h=0;h<n.length;++h)n[h]()},o={},i=function(h,m){Qe(function(){r(h,m)})};Qe(function(){i=r});for(var l=e.length-22;W(e,l)!=101010256;--l)if(!l||e.length-l>65558)return i(I(13,0,1),null),a;var s=Y(e,l+8);if(s){var u=s,c=W(e,l+16),f=c==4294967295||u==65535;if(f){var v=W(e,l-12);f=W(e,v)==101075792,f&&(u=s=W(e,v+32),c=W(e,v+48))}for(var y=t&&t.filter,k=function(h){var m=Pt(e,c,f),b=m[0],g=m[1],B=m[2],E=m[3],z=m[4],C=m[5],p=Ft(e,C);c=z;var d=function(M,O){M?(a(),i(M,null)):(O&&(o[E]=O),--s||i(null,o))};if(!y||y({name:E,size:g,originalSize:B,compression:b}))if(!b)d(null,se(e,p,p+g));else if(b==8){var T=e.subarray(p,p+g);if(B<524288||g>.8*B)try{d(null,Ge(T,{out:new x(B)}))}catch(M){d(M,null)}else n.push(zt(T,{size:B},d))}else d(I(14,"unknown compression type "+b,1),null);else d(null,null)},w=0;w<u;++w)k(w)}else i(null,{});return a}let re=[],ie=[],J=1;const he=10;let P=new Set;document.addEventListener("DOMContentLoaded",async()=>{document.getElementById("searchInput").addEventListener("input",Ce),document.getElementById("prevBtn").addEventListener("click",()=>Xe(-1)),document.getElementById("nextBtn").addEventListener("click",()=>Xe(1)),document.getElementById("receiveBtn").addEventListener("click",()=>document.getElementById("receiveInput").click()),document.getElementById("receiveInput").addEventListener("change",r=>{r.target.files.length>0&&Vt(r.target.files[0],"receiveBtn")}),document.getElementById("selectAllBtn").addEventListener("click",Jt),document.getElementById("cancelSelectionBtn").addEventListener("click",jt),document.getElementById("deleteSelectedBtn").addEventListener("click",Wt),document.getElementById("sendSelectedBtn").addEventListener("click",()=>{Kt(P,"shared_books",".send","sendSelectedBtn")});const e=()=>{const r=dt(),n=document.getElementById("folderName");n&&(n.textContent=r||"Belum dipilih")};if(document.getElementById("changeDirBtn").addEventListener("click",async()=>{await Ne()&&(e(),Ee())}),await gt())e(),Ee();else{const r=document.getElementById("setupModal");r&&(r.style.display="flex",document.getElementById("modalSelectBtn").onclick=async()=>{try{await Ne()&&(r.style.display="none",e(),Ee())}catch(n){if(console.log("Selection failed:",n),n.name==="AbortError")return;n.message.includes("system")||n.name==="SecurityError"||n.name==="NotAllowedError"?alert(`Browser MEMBLOKIR folder ini.

Browser tidak mengizinkan akses ke folder sistem (seperti Downloads atau Documents) secara langsung.

SOLUSI: Buat folder baru (misal: 'BukuPusnas') dan pilih folder tersebut.`):alert("Gagal memilih folder: "+n.message)}})}});async function Ee(){try{document.getElementById("loading").style.display="block",re=await Pe(!0),re.sort((e,t)=>{const r=e.savedAt?new Date(e.savedAt).getTime():0;return(t.savedAt?new Date(t.savedAt).getTime():0)-r}),Ce()}catch(e){console.log("Error loading books:",e),alert("Gagal memuat daftar buku: "+e.message)}finally{document.getElementById("loading").style.display="none"}}function Ce(){const e=document.getElementById("searchInput").value.toLowerCase();e?ie=re.filter(t=>{const r=(t.title||"").toLowerCase(),n=(t.author||"").toLowerCase();return r.includes(e)||n.includes(e)}):ie=re,J=1,Le()}function Xe(e){J+=e,Le()}function Le(){const e=document.getElementById("bookGrid"),t=document.getElementById("emptyState"),r=document.getElementById("pageInfo"),n=document.getElementById("prevBtn"),a=document.getElementById("nextBtn");if(e.innerHTML="",ie.length===0){t.style.display="block",e.style.display="none",r.textContent="0 / 0",n.disabled=!0,a.disabled=!0;return}t.style.display="none",e.style.display="grid";const o=Math.ceil(ie.length/he);J>o&&(J=o),J<1&&(J=1);const i=(J-1)*he,l=i+he;ie.slice(i,l).forEach(u=>{const c=qt(u);e.appendChild(c)}),r.textContent=`${J} / ${o}`,n.disabled=J===1,a.disabled=J===o}function qt(e){const t=document.createElement("div");t.className="book-card";const r=e.cover||"icons/icon128.png",n=P.has(e.bookId)?"checked":"";t.innerHTML=`
        <div class="book-checkbox-wrapper ${n?"checked":""}">
            <input type="checkbox" class="book-checkbox" ${n}>
        </div>
        <div class="cover-wrapper">
            <img src="${r}" alt="${e.title}" onerror="this.src='icons/icon128.png'">
        </div>
        <div class="book-info">
            <div class="book-title" title="${e.title}">${e.title||"Tanpa Judul"}</div>
            <div class="book-author" title="${e.author}">${e.author||"Tanpa Pengarang"}</div>
            <div class="actions">
                <button class="download-btn" title="Buka/Unduh File">
                    Unduh Buku
                </button>
                <button class="delete-btn" title="Hapus Buku">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </button>
            </div>
        </div>
    `;const a=t.querySelector(".download-btn");a.onclick=()=>Ht(e);const o=t.querySelector(".delete-btn");o.onclick=()=>Zt(e);const i=t.querySelector(".book-checkbox"),l=t.querySelector(".book-checkbox-wrapper");return i.onchange=s=>{s.target.checked?(P.add(e.bookId),l.classList.add("checked")):(P.delete(e.bookId),l.classList.remove("checked")),Ae()},t}async function Ht(e){try{const t=await _e(e.bookId);if(t.file){const r=t.file,n=t.ext||"pdf",o=`${(e.title||"book").replace(/[/\\?%*:|"<>]/g,"-")}.${n}`,i=URL.createObjectURL(r);chrome.downloads.download({url:i,filename:o,saveAs:!0},l=>{setTimeout(()=>URL.revokeObjectURL(i),1e3),chrome.runtime.lastError&&(console.log(chrome.runtime.lastError),alert("Gagal membuka/unduh: "+chrome.runtime.lastError.message))})}else alert("File buku tidak ditemukan.")}catch(t){console.log("Open file error:",t),alert("Gagal membuka buku: "+t.message)}}async function Zt(e){if(confirm(`Apakah Anda yakin ingin menghapus buku "${e.title}"?`))try{await et(e.bookId),re=re.filter(t=>t.bookId!==e.bookId),Ce()}catch(t){console.log("Delete error:",t),alert("Gagal menghapus buku: "+t.message)}}function Ae(){const e=document.getElementById("bulkActionBar"),t=document.getElementById("selectedCount");t.textContent=P.size,P.size>0?e.classList.add("visible"):e.classList.remove("visible")}function jt(){P.clear(),Le(),Ae()}function Jt(){const e=(J-1)*he,t=e+he,r=ie.slice(e,t);let n=!0;for(const a of r)if(!P.has(a.bookId)){n=!1;break}n?r.forEach(a=>P.delete(a.bookId)):r.forEach(a=>P.add(a.bookId)),Le(),Ae()}async function Wt(){if(P.size!==0&&confirm(`Hapus ${P.size} buku yang dipilih?`))try{for(const e of P)await et(e);re=re.filter(e=>!P.has(e.bookId)),P.clear(),Ce(),Ae()}catch(e){console.log("Bulk delete error:",e),alert("Gagal menghapus beberapa buku: "+e.message)}}async function Kt(e,t,r,n){const a=document.getElementById(n);if(!a)return;const o=a.textContent,i=new Date().toISOString().slice(0,10),l=`${t}_${i}${r}`;try{const u=await(await window.showSaveFilePicker({suggestedName:l,types:[{description:r===".backup"?"Library Backup":"Shared Books",accept:{"application/zip":[r]}}]})).createWritable(),c=new Nt((g,B,E)=>{if(g)throw g;B.length>0&&u.write(B),E&&u.close()});let f=await Pe();e&&(f=f.filter(g=>e.has(g.bookId)));const v=[],y=[];for(const g of f){v.push(g);try{const B=await _e(g.bookId);B.file&&y.push({id:g.bookId,file:B.file,ext:g.ext||"pdf"})}catch(B){console.log(`Skipping file for ${g.bookId}:`,B)}}const k={version:2,timestamp:new Date().toISOString(),type:e?"partial":"full",booklist:f,books:v},w=JSON.stringify(k,null,2),h=new Ye("metadata.json",{level:9});c.add(h),h.push(new TextEncoder().encode(w),!0);let m=0;const b=y.length;for(const g of y){m++,a.textContent=`Proses... ${m}/${b}`;const B=`files/${g.id}.${g.ext}`,E=new Ye(B,{level:0});c.add(E);const z=g.file.stream().getReader();for(;;){const{done:C,value:p}=await z.read();if(C)break;E.push(p,!1)}E.push(new Uint8Array(0),!0)}c.end(),a.textContent=o,alert("Proses selesai!")}catch(s){console.log("Export failed:",s),s.name!=="AbortError"&&alert("Gagal: "+s.message),a.textContent=o}}async function Vt(e,t){const r=document.getElementById(t);r&&(r.textContent="Processing...",r.disabled=!0);try{await Yt(e,(n,a)=>{r&&(r.textContent=`Importing... ${n}/${a}`)}),alert("Import selesai."),Ee()}catch(n){console.log("Import error",n),alert("Gagal import: "+n.message)}finally{r&&(r.textContent="Terima",r.disabled=!1),document.getElementById("receiveInput").value=""}}async function Yt(e,t){if(!e)throw new Error("File tidak valid");let r;try{r=await e.arrayBuffer()}catch(a){throw new Error("Gagal membaca file: "+a.message)}const n=new Uint8Array(r);return new Promise((a,o)=>{Rt(n,async(i,l)=>{if(i)return console.log("Unzip error:",i),o(new Error("Gagal mengekstrak ZIP: "+i.message));try{let s=[];if(l["metadata.json"])try{const h=new TextDecoder().decode(l["metadata.json"]),m=JSON.parse(h);m.books&&Array.isArray(m.books)&&(s=m.books)}catch(h){console.log("Metadata parse error",h)}const u=new Map;s.forEach(h=>u.set(h.bookId,h));const c=Object.keys(l).filter(h=>h.startsWith("files/")),f=c.length;let v=0;for(const h of c){const m=h.split("/").pop(),b=m.split(".")[0],g=m.split(".").pop();if(!b)continue;const B=l[h],E=g==="epub"?"application/epub+zip":"application/pdf",z=new Blob([B],{type:E}),C=await mt(b,z,g),p=u.get(b)||{bookId:b};u.set(b,{...p,...C,ext:g}),v++,t(v,f)}const y=await Pe(),k=new Map;y.forEach(h=>k.set(h.bookId,h));for(const[h,m]of u.entries())k.set(h,m);const w=Array.from(k.values());await pt(w),a()}catch(s){console.log("Processing error:",s),o(s)}})})}
